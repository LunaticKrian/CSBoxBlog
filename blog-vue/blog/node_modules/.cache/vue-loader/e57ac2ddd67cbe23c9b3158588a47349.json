{"remainingRequest":"E:\\work\\project\\CSBoxBlog\\blog-vue\\blog\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\work\\project\\CSBoxBlog\\blog-vue\\blog\\src\\components\\ChatRoom.vue?vue&type=style&index=0&id=56c7db03&scoped=true&lang=css&","dependencies":[{"path":"E:\\work\\project\\CSBoxBlog\\blog-vue\\blog\\src\\components\\ChatRoom.vue","mtime":1678940307222},{"path":"E:\\work\\project\\CSBoxBlog\\blog-vue\\blog\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\work\\project\\CSBoxBlog\\blog-vue\\blog\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\work\\project\\CSBoxBlog\\blog-vue\\blog\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\work\\project\\CSBoxBlog\\blog-vue\\blog\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\work\\project\\CSBoxBlog\\blog-vue\\blog\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCg0KQG1lZGlhIChtaW4td2lkdGg6IDc2MHB4KSB7DQogIC5jaGF0LWNvbnRhaW5lciB7DQogICAgcG9zaXRpb246IGZpeGVkOw0KICAgIGNvbG9yOiAjNGM0OTQ4ICFpbXBvcnRhbnQ7DQogICAgYm90dG9tOiAxMDRweDsNCiAgICByaWdodDogMjBweDsNCiAgICBoZWlnaHQ6IGNhbGMoODUlIC0gNjRweCAtIDIwcHgpOw0KICAgIG1heC1oZWlnaHQ6IDU5MHB4ICFpbXBvcnRhbnQ7DQogICAgbWluLWhlaWdodDogMjUwcHggIWltcG9ydGFudDsNCiAgICB3aWR0aDogNDAwcHggIWltcG9ydGFudDsNCiAgICBib3JkZXItcmFkaXVzOiAxNnB4ICFpbXBvcnRhbnQ7DQogIH0NCiAgLmNsb3NlIHsNCiAgICBkaXNwbGF5OiBub25lOw0KICB9DQp9DQpAbWVkaWEgKG1heC13aWR0aDogNzYwcHgpIHsNCiAgLmNoYXQtY29udGFpbmVyIHsNCiAgICBwb3NpdGlvbjogZml4ZWQ7DQogICAgdG9wOiAwOw0KICAgIGJvdHRvbTogMDsNCiAgICByaWdodDogMDsNCiAgICBsZWZ0OiAwOw0KICB9DQogIC5jbG9zZSB7DQogICAgZGlzcGxheTogYmxvY2s7DQogICAgbWFyZ2luLWxlZnQ6IGF1dG87DQogIH0NCn0NCi5jaGF0LWNvbnRhaW5lciB7DQogIGJveC1zaGFkb3c6IDAgNXB4IDQwcHggcmdiYSgwLCAwLCAwLCAwLjE2KSAhaW1wb3J0YW50Ow0KICBmb250LXNpemU6IDE0cHg7DQogIGJhY2tncm91bmQ6ICNmNGY2ZmI7DQogIHotaW5kZXg6IDEyMDA7DQp9DQouY2hhdC1idG4gew0KICBiYWNrZ3JvdW5kOiAjMWY5M2ZmOw0KICBib3JkZXItcmFkaXVzOiAxMDBweCAhaW1wb3J0YW50Ow0KICBwb3NpdGlvbjogZml4ZWQ7DQogIGJvdHRvbTogMTVweDsNCiAgcmlnaHQ6IDVweDsNCiAgYm94LXNoYWRvdzogMCA4cHggMjRweCByZ2JhKDAsIDAsIDAsIDAuMTYpICFpbXBvcnRhbnQ7DQogIGN1cnNvcjogcG9pbnRlcjsNCiAgaGVpZ2h0OiA2MHB4ICFpbXBvcnRhbnQ7DQogIHdpZHRoOiA2MHB4ICFpbXBvcnRhbnQ7DQogIHotaW5kZXg6IDEwMDAgIWltcG9ydGFudDsNCiAgdXNlci1zZWxlY3Q6IG5vbmU7DQp9DQouaGVhZGVyIHsNCiAgZGlzcGxheTogZmxleDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgcGFkZGluZzogMjBweCAyNHB4Ow0KICBiYWNrZ3JvdW5kOiAjZmZmZmZmOw0KICBib3JkZXItcmFkaXVzOiAxcmVtIDFyZW0gMCAwOw0KICBib3gtc2hhZG93OiAwIDEwcHggMTVweCAtMTZweCByZ2JhKDUwLCA1MCwgOTMsIDAuMDgpLA0KICAgIDAgNHB4IDZweCAtOHB4IHJnYmEoNTAsIDUwLCA5MywgMC4wNCk7DQp9DQouZm9vdGVyIHsNCiAgcGFkZGluZzogOHB4IDE2cHg7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgd2lkdGg6IDEwMCU7DQogIGJvdHRvbTogMDsNCiAgYmFja2dyb3VuZDogI2Y3ZjdmNzsNCiAgYm9yZGVyLXJhZGl1czogMCAwIDFyZW0gMXJlbTsNCiAgZGlzcGxheTogZmxleDsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCi5mb290ZXIgdGV4dGFyZWEgew0KICBiYWNrZ3JvdW5kOiAjZmZmOw0KICBwYWRkaW5nLWxlZnQ6IDEwcHg7DQogIHBhZGRpbmctdG9wOiA4cHg7DQogIHdpZHRoOiAxMDAlOw0KICBoZWlnaHQ6IDMycHg7DQogIG91dGxpbmU6IG5vbmU7DQogIHJlc2l6ZTogbm9uZTsNCiAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgZm9udC1zaXplOiAxM3B4Ow0KfQ0KLnZvaWNlLWJ0biB7DQogIGZvbnQtc2l6ZTogMTNweDsNCiAgb3V0bGluZTogbm9uZTsNCiAgaGVpZ2h0OiAzMnB4Ow0KICB3aWR0aDogMTAwJTsNCiAgYmFja2dyb3VuZDogI2ZmZjsNCiAgYm9yZGVyLXJhZGl1czogMnB4Ow0KfQ0KLm1lc3NhZ2Ugew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIHdpZHRoOiAxMDAlOw0KICBwYWRkaW5nOiAyMHB4IDE2cHggMCAxNnB4Ow0KICB0b3A6IDgwcHg7DQogIGJvdHRvbTogNTBweDsNCiAgb3ZlcmZsb3cteTogYXV0bzsNCiAgb3ZlcmZsb3cteDogaGlkZGVuOw0KfQ0KLnRleHQgew0KICBjb2xvcjogIzk5OTsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KICBmb250LXNpemU6IDEycHg7DQogIG1hcmdpbi1ib3R0b206IDEycHg7DQp9DQoudXNlci1tZXNzYWdlIHsNCiAgZGlzcGxheTogZmxleDsNCiAgbWFyZ2luLWJvdHRvbTogMTBweDsNCn0NCi5teS1tZXNzYWdlIHsNCiAgZGlzcGxheTogZmxleDsNCiAgbWFyZ2luLWJvdHRvbTogMTBweDsNCiAganVzdGlmeS1jb250ZW50OiBmbGV4LWVuZDsNCn0NCi5sZWZ0LWF2YXRhciB7DQogIG1hcmdpbi1yaWdodDogMTBweDsNCn0NCi5yaWdodC1hdmF0YXIgew0KICBvcmRlcjogMTsNCiAgbWFyZ2luLWxlZnQ6IDEwcHg7DQp9DQoudXNlci1hdmF0YXIgew0KICB3aWR0aDogNDBweDsNCiAgaGVpZ2h0OiA0MHB4Ow0KICBib3JkZXItcmFkaXVzOiA1MCU7DQp9DQoubmlja25hbWUgew0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICBmb250LXNpemU6IDEycHg7DQogIG1hcmdpbi10b3A6IDNweDsNCiAgbWFyZ2luLWJvdHRvbTogNXB4Ow0KfQ0KLnVzZXItY29udGVudCB7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjsNCiAgcGFkZGluZzogMTBweDsNCiAgYm9yZGVyLXJhZGl1czogNXB4IDIwcHggMjBweCAyMHB4Ow0KICB3aWR0aDogZml0LWNvbnRlbnQ7DQogIHdoaXRlLXNwYWNlOiBwcmUtbGluZTsNCiAgd29yZC13cmFwOiBicmVhay13b3JkOw0KICB3b3JkLWJyZWFrOiBicmVhay1hbGw7DQp9DQoubXktY29udGVudCB7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgYm9yZGVyLXJhZGl1czogMjBweCA1cHggMjBweCAyMHB4Ow0KICBwYWRkaW5nOiAxMnB4Ow0KICBiYWNrZ3JvdW5kOiAjMTJiN2Y1Ow0KICBjb2xvcjogI2ZmZjsNCiAgd2hpdGUtc3BhY2U6IHByZS1saW5lOw0KICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7DQogIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsNCn0NCi5zdWJtaXQtYnRuIHsNCiAgY29sb3I6IHJnYigzMSwgMTQ3LCAyNTUpOw0KfQ0KLmVtb2ppIHsNCiAgY3Vyc29yOiBwb2ludGVyOw0KICBmb250LXNpemU6IDEuM3JlbTsNCiAgbWFyZ2luOiAwIDhweDsNCn0NCi5lbW9qaS1ib3ggew0KICBwb3NpdGlvbjogYWJzb2x1dGU7DQogIGJveC1zaGFkb3c6IDAgOHB4IDE2cHggcmdiYSg1MCwgNTAsIDkzLCAwLjA4KSwgMCA0cHggMTJweCByZ2JhKDAsIDAsIDAsIDAuMDcpOw0KICBiYWNrZ3JvdW5kOiAjZmZmOw0KICBib3JkZXItcmFkaXVzOiA4cHg7DQogIHJpZ2h0OiAyMHB4Ow0KICBib3R0b206IDUycHg7DQogIGhlaWdodDogMTgwcHg7DQogIHdpZHRoOiAzMDBweDsNCiAgb3ZlcmZsb3cteTogYXV0bzsNCiAgcGFkZGluZzogNnB4IDE2cHg7DQp9DQouZW1vamktYm9yZGVyOmJlZm9yZSB7DQogIGRpc3BsYXk6IGJsb2NrOw0KICBoZWlnaHQ6IDA7DQogIHdpZHRoOiAwOw0KICBjb250ZW50OiAiIjsNCiAgYm9yZGVyLWxlZnQ6IDE0cHggc29saWQgdHJhbnNwYXJlbnQ7DQogIGJvcmRlci1yaWdodDogMTRweCBzb2xpZCB0cmFuc3BhcmVudDsNCiAgYm9yZGVyLXRvcDogMTJweCBzb2xpZCAjZmZmOw0KICBib3R0b206IDQwcHg7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgcmlnaHQ6IDQzcHg7DQp9DQoudW5yZWFkIHsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KICBib3JkZXItcmFkaXVzOiA1MCU7DQogIGZvbnQtc2l6ZTogMTRweDsNCiAgaGVpZ2h0OiAyMHB4Ow0KICB3aWR0aDogMjBweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBiYWNrZ3JvdW5kOiAjZjI0ZjJkOw0KICBjb2xvcjogI2ZmZjsNCn0NCi5iYWNrLW1lbnUgew0KICBmb250LXNpemU6IDEzcHg7DQogIGJvcmRlci1yYWRpdXM6IDJweDsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuOSk7DQogIGNvbG9yOiAjMDAwOw0KICB3aWR0aDogODBweDsNCiAgaGVpZ2h0OiAzNXB4Ow0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIGxpbmUtaGVpZ2h0OiAzNXB4Ow0KICBkaXNwbGF5OiBub25lOw0KfQ0KLnZvaWNlIHsNCiAgcG9zaXRpb246IGZpeGVkOw0KICB6LWluZGV4OiAxNTAwOw0KICBib3R0b206IDUycHg7DQogIGxlZnQ6IDA7DQogIHJpZ2h0OiAwOw0KICB0b3A6IDgwcHg7DQogIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC44KTsNCn0NCi5jbG9zZS12b2ljZSB7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgYm90dG9tOiA2MHB4Ow0KICBsZWZ0OiAzMHB4Ow0KICBkaXNwbGF5OiBpbmxpbmUtYmxvY2s7DQogIGhlaWdodDogNTBweDsNCiAgd2lkdGg6IDUwcHg7DQogIGxpbmUtaGVpZ2h0OiA1MHB4Ow0KICBib3JkZXItcmFkaXVzOiA1MCU7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgYmFja2dyb3VuZDogI2ZmZjsNCn0NCg=="},{"version":3,"sources":["ChatRoom.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChatRoom.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <div>\r\n    <!-- 聊天界面 -->\r\n    <div\r\n      class=\"chat-container animated bounceInUp\"\r\n      v-show=\"isShow\"\r\n      @click=\"closeAll\"\r\n      @contextmenu.prevent.stop=\"closeAll\"\r\n    >\r\n      <!-- 标题 -->\r\n      <div class=\"header\">\r\n        <img\r\n          width=\"32\"\r\n          height=\"32\"\r\n          src=\"https://static.talkxj.com/config/logo.png\"\r\n        />\r\n        <div style=\"margin-left:12px\">\r\n          <div>聊天室</div>\r\n          <div style=\"font-size:12px\">当前{{ count }}人在线</div>\r\n        </div>\r\n        <v-icon class=\"close\" @click=\"isShow = false\">\r\n          mdi-close\r\n        </v-icon>\r\n      </div>\r\n      <!-- 对话内容 -->\r\n      <div class=\"message\" id=\"message\">\r\n        <!-- 录音遮罩层 -->\r\n        <div\r\n          v-show=\"voiceActive\"\r\n          class=\"voice\"\r\n          @mousemove.prevent.stop=\"translationmove($event)\"\r\n          @mouseup.prevent.stop=\"translationEnd($event)\"\r\n        >\r\n          <v-icon ref=\"voiceClose\" class=\"close-voice\">mdi-close</v-icon>\r\n        </div>\r\n        <div\r\n          :class=\"isMyMessage(item)\"\r\n          v-for=\"(item, index) of chatRecordList\"\r\n          :key=\"index\"\r\n        >\r\n          <!-- 头像 -->\r\n          <img :src=\"item.avatar\" :class=\"isleft(item)\" />\r\n          <div>\r\n            <div class=\"nickname\" v-if=\"!isSelf(item)\">\r\n              {{ item.nickname }}\r\n              <span style=\"margin-left:12px\">{{ item.createTime | hour }}</span>\r\n            </div>\r\n            <!-- 内容 -->\r\n            <div\r\n              ref=\"content\"\r\n              @contextmenu.prevent.stop=\"showBack(item, index, $event)\"\r\n              :class=\"isMyContent(item)\"\r\n            >\r\n              <!-- 文字消息 -->\r\n              <div v-if=\"item.type == 3\" v-html=\"item.content\" />\r\n              <!-- 语音消息 -->\r\n              <div v-if=\"item.type == 5\" @click.prevent.stop=\"playVoice(item)\">\r\n                <audio\r\n                  @ended=\"endVoice(item)\"\r\n                  @canplay=\"getVoiceTime(item)\"\r\n                  ref=\"voices\"\r\n                  :src=\"item.content\"\r\n                  style=\"display:none\"\r\n                />\r\n                <!-- 播放 -->\r\n                <v-icon\r\n                  :color=\"isSelf(item) ? '#fff' : '#000'\"\r\n                  ref=\"plays\"\r\n                  style=\"display:inline-flex;cursor: pointer;\"\r\n                >\r\n                  mdi-arrow-right-drop-circle\r\n                </v-icon>\r\n                <!-- 暂停 -->\r\n                <v-icon\r\n                  :color=\"isSelf(item) ? '#fff' : '#000'\"\r\n                  ref=\"pauses\"\r\n                  style=\"display:none;cursor: pointer;\"\r\n                >\r\n                  mdi-pause-circle\r\n                </v-icon>\r\n                <!-- 音频时长 -->\r\n                <span ref=\"voiceTimes\" />\r\n              </div>\r\n              <div class=\"back-menu\" ref=\"backBtn\" @click=\"back(item, index)\">\r\n                撤回\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <!-- 输入框 -->\r\n      <div class=\"footer\">\r\n        <!-- 表情框 -->\r\n        <div class=\"emoji-box\" v-show=\"isEmoji\">\r\n          <Emoji :chooseEmoji=\"true\" @addEmoji=\"addEmoji\" />\r\n        </div>\r\n        <div class=\"emoji-border\" v-show=\"isEmoji\" />\r\n        <!-- 切换输入方式 -->\r\n        <v-icon\r\n          v-show=\"!isVoice\"\r\n          @click=\"isVoice = !isVoice\"\r\n          style=\"margin-right: 8px\"\r\n        >\r\n          mdi-microphone\r\n        </v-icon>\r\n        <v-icon\r\n          v-show=\"isVoice\"\r\n          @click=\"isVoice = !isVoice\"\r\n          style=\"margin-right: 8px\"\r\n        >\r\n          mdi-keyboard\r\n        </v-icon>\r\n        <!-- 文字输入 -->\r\n        <textarea\r\n          v-show=\"!isVoice\"\r\n          ref=\"chatInput\"\r\n          v-model=\"content\"\r\n          @keydown.enter=\"saveMessage($event)\"\r\n          placeholder=\"请输入内容\"\r\n        />\r\n        <!-- 语音输入 -->\r\n        <button\r\n          class=\"voice-btn\"\r\n          v-show=\"isVoice\"\r\n          @mousedown.prevent.stop=\"translationStart\"\r\n          @mouseup.prevent.stop=\"translationEnd($event)\"\r\n          @touchstart.prevent.stop=\"translationStart\"\r\n          @touchend.prevent.stop=\"translationEnd($event)\"\r\n          @touchmove.prevent.stop=\"translationmove($event)\"\r\n        >\r\n          按住说话\r\n        </button>\r\n        <!-- 表情 -->\r\n        <i\r\n          class=\"iconfont iconbiaoqing emoji\"\r\n          :style=\"isEmoji ? 'color:#FFC83D' : ''\"\r\n          @click.prevent.stop=\"openEmoji\"\r\n        />\r\n        <!-- 发送按钮 -->\r\n        <i :class=\"isInput\" @click=\"saveMessage\" style=\"font-size: 1.5rem\" />\r\n      </div>\r\n    </div>\r\n    <!-- 未读数量 -->\r\n    <div class=\"chat-btn\" @click=\"open\">\r\n      <span class=\"unread\" v-if=\"unreadCount > 0\">{{ unreadCount }}</span>\r\n      <img\r\n        width=\"100%\"\r\n        height=\"100%\"\r\n        src=\"https://static.talkxj.com/config/logo.png\"\r\n      />\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Recorderx, { ENCODE_TYPE } from \"recorderx\";\r\nimport Emoji from \"./Emoji\";\r\nimport EmojiList from \"../assets/js/emoji\";\r\nexport default {\r\n  components: {\r\n    Emoji\r\n  },\r\n  updated() {\r\n    var ele = document.getElementById(\"message\");\r\n    ele.scrollTop = ele.scrollHeight;\r\n  },\r\n  beforeDestroy() {\r\n    clearInterval(this.heartBeat);\r\n  },\r\n  data: function() {\r\n    return {\r\n      isEmoji: false,\r\n      isShow: false,\r\n      websocket: null,\r\n      content: \"\",\r\n      chatRecordList: [],\r\n      voiceList: [],\r\n      rc: null,\r\n      ipAddress: \"\",\r\n      ipSource: \"\",\r\n      count: 0,\r\n      unreadCount: 0,\r\n      isVoice: false,\r\n      voiceActive: false,\r\n      startVoiceTime: null,\r\n      WebsocketMessage: {\r\n        type: null,\r\n        data: null\r\n      },\r\n      heartBeat: null\r\n    };\r\n  },\r\n  methods: {\r\n    open() {\r\n      if (this.websocket == null) {\r\n        this.connect();\r\n      }\r\n      this.unreadCount = 0;\r\n      this.isShow = !this.isShow;\r\n    },\r\n    openEmoji() {\r\n      this.isEmoji = !this.isEmoji;\r\n      this.isVoice = false;\r\n    },\r\n    connect() {\r\n      var that = this;\r\n      this.websocket = new WebSocket(this.blogInfo.websiteConfig.websocketUrl);\r\n      // 连接发生错误的回调方法\r\n      this.websocket.onerror = function(event) {\r\n        console.log(event);\r\n        alert(\"失败\");\r\n      };\r\n      // 连接成功建立的回调方法\r\n      this.websocket.onopen = function(event) {\r\n        console.log(event);\r\n        // 发送心跳消息\r\n        that.heartBeat = setInterval(function() {\r\n          var beatMessage = {\r\n            type: 6,\r\n            data: \"ping\"\r\n          };\r\n          that.websocket.send(JSON.stringify(beatMessage));\r\n        }, 30 * 1000);\r\n      };\r\n      // 接收到消息的回调方法\r\n      this.websocket.onmessage = function(event) {\r\n        const data = JSON.parse(event.data);\r\n        switch (data.type) {\r\n          case 1:\r\n            // 在线人数\r\n            that.count = data.data;\r\n            break;\r\n          case 2:\r\n            // 历史记录\r\n            that.chatRecordList = data.data.chatRecordList;\r\n            that.chatRecordList.forEach(item => {\r\n              if (item.type == 5) {\r\n                that.voiceList.push(item.id);\r\n              }\r\n            });\r\n            that.ipAddress = data.data.ipAddress;\r\n            that.ipSource = data.data.ipSource;\r\n            break;\r\n          case 3:\r\n            // 文字消息\r\n            that.chatRecordList.push(data.data);\r\n            if (!that.isShow) {\r\n              that.unreadCount++;\r\n            }\r\n            break;\r\n          case 4:\r\n            // 撤回\r\n            if (data.data.isVoice) {\r\n              that.voiceList.splice(that.voiceList.indexOf(data.data.id), 1);\r\n            }\r\n            for (var i = 0; i < that.chatRecordList.length; i++) {\r\n              if (that.chatRecordList[i].id == data.data.id) {\r\n                that.chatRecordList.splice(i, 1);\r\n                i--;\r\n              }\r\n            }\r\n            break;\r\n          case 5:\r\n            // 语音消息\r\n            that.voiceList.push(data.data.id);\r\n            that.chatRecordList.push(data.data);\r\n            if (!that.isShow) {\r\n              that.unreadCount++;\r\n            }\r\n            break;\r\n        }\r\n      };\r\n      //连接关闭的回调方法\r\n      this.websocket.onclose = function() {};\r\n    },\r\n    saveMessage(e) {\r\n      e.preventDefault();\r\n      if (this.content.trim() == \"\") {\r\n        this.$toast({ type: \"error\", message: \"内容不能为空\" });\r\n        return false;\r\n      }\r\n      //解析表情\r\n      var reg = /\\[.+?\\]/g;\r\n      this.content = this.content.replace(reg, function(str) {\r\n        return (\r\n          \"<img src= '\" +\r\n          EmojiList[str] +\r\n          \"' width='24'height='24' style='margin: 0 1px;vertical-align: text-bottom'/>\"\r\n        );\r\n      });\r\n      var socketMsg = {\r\n        nickname: this.nickname,\r\n        avatar: this.avatar,\r\n        content: this.content,\r\n        userId: this.userId,\r\n        type: 3,\r\n        ipAddress: this.ipAddress,\r\n        ipSource: this.ipSource\r\n      };\r\n      this.WebsocketMessage.type = 3;\r\n      this.WebsocketMessage.data = socketMsg;\r\n      this.websocket.send(JSON.stringify(this.WebsocketMessage));\r\n      this.content = \"\";\r\n    },\r\n    addEmoji(key) {\r\n      this.isEmoji = false;\r\n      this.$refs.chatInput.focus();\r\n      this.content += key;\r\n    },\r\n    // 展示菜单\r\n    showBack(item, index, e) {\r\n      this.$refs.backBtn.forEach(item => {\r\n        item.style.display = \"none\";\r\n      });\r\n      if (\r\n        item.ipAddress == this.ipAddress ||\r\n        (item.userId != null && item.userId == this.userId)\r\n      ) {\r\n        this.$refs.backBtn[index].style.left = e.offsetX + \"px\";\r\n        this.$refs.backBtn[index].style.bottom = e.offsetY + \"px\";\r\n        this.$refs.backBtn[index].style.display = \"block\";\r\n      }\r\n    },\r\n    // 撤回消息\r\n    back(item, index) {\r\n      var socketMsg = {\r\n        id: item.id,\r\n        isVoice: item.type == 5\r\n      };\r\n      this.WebsocketMessage.type = 4;\r\n      this.WebsocketMessage.data = socketMsg;\r\n      this.websocket.send(JSON.stringify(this.WebsocketMessage));\r\n      this.$refs.backBtn[index].style.display = \"none\";\r\n    },\r\n    closeAll() {\r\n      this.isEmoji = false;\r\n      if (this.chatRecordList.length > 0) {\r\n        this.$refs.backBtn.forEach(item => {\r\n          item.style.display = \"none\";\r\n        });\r\n      }\r\n    },\r\n    // 录音开始\r\n    translationStart() {\r\n      this.voiceActive = true;\r\n      let that = this;\r\n      that.rc = new Recorderx();\r\n      that.$nextTick(() => {\r\n        that.rc\r\n          .start()\r\n          .then(() => {\r\n            that.startVoiceTime = new Date();\r\n            console.log(\"start recording\");\r\n          })\r\n          .catch(error => {\r\n            console.log(\"Recording failed.\", error);\r\n          });\r\n      });\r\n    },\r\n    // 录音结束\r\n    translationEnd() {\r\n      console.log(\"结束\");\r\n      this.voiceActive = false;\r\n      this.rc.pause();\r\n      if (new Date() - this.startVoiceTime < 1000) {\r\n        this.$toast({ type: \"error\", message: \"按键时间太短\" });\r\n        return false;\r\n      }\r\n      var wav = this.rc.getRecord({\r\n        encodeTo: ENCODE_TYPE.WAV\r\n      });\r\n      var file = new File([wav], \"voice.wav\", {\r\n        type: wav.type\r\n      });\r\n      var formData = new window.FormData();\r\n      formData.append(\"file\", file);\r\n      formData.append(\"type\", 5);\r\n      formData.append(\"nickname\", this.nickname);\r\n      formData.append(\"avatar\", this.avatar);\r\n      if (this.userId != null) {\r\n        formData.append(\"userId\", this.userId);\r\n      }\r\n      formData.append(\"ipAddress\", this.ipAddress);\r\n      formData.append(\"ipSource\", this.ipSource);\r\n      var options = {\r\n        url: \"/api/voice\",\r\n        data: formData,\r\n        method: \"post\",\r\n        headers: {\r\n          \"Content-Type\": \"multipart/form-data\"\r\n        }\r\n      };\r\n      this.axios(options);\r\n    },\r\n    translationmove() {},\r\n    // 播放语音\r\n    playVoice(item) {\r\n      var player = this.$refs.voices[this.voiceList.indexOf(item.id)];\r\n      if (player.paused) {\r\n        player.play();\r\n        this.$refs.plays[this.voiceList.indexOf(item.id)].$el.style.display =\r\n          \"none\";\r\n        this.$refs.pauses[this.voiceList.indexOf(item.id)].$el.style.display =\r\n          \"inline-flex\";\r\n      } else {\r\n        this.$refs.plays[this.voiceList.indexOf(item.id)].$el.style.display =\r\n          \"inline-flex\";\r\n        this.$refs.pauses[this.voiceList.indexOf(item.id)].$el.style.display =\r\n          \"none\";\r\n        player.pause();\r\n      }\r\n    },\r\n    // 语音结束\r\n    endVoice(item) {\r\n      this.$refs.plays[this.voiceList.indexOf(item.id)].$el.style.display =\r\n        \"inline-flex\";\r\n      this.$refs.pauses[this.voiceList.indexOf(item.id)].$el.style.display =\r\n        \"none\";\r\n    },\r\n    // 获取语音时长\r\n    getVoiceTime(item) {\r\n      var time = this.$refs.voices[this.voiceList.indexOf(item.id)].duration;\r\n      time = Math.ceil(time);\r\n      var str = \"⬝⬝⬝\";\r\n      for (var i = 0; i < time; i++) {\r\n        if (i % 2 == 0) {\r\n          str += \"⬝\";\r\n        }\r\n      }\r\n      this.$refs.voiceTimes[this.voiceList.indexOf(item.id)].innerHTML =\r\n        \" \" + str + \" \" + time + \" ''\";\r\n    }\r\n  },\r\n  computed: {\r\n    isSelf() {\r\n      return function(item) {\r\n        return (\r\n          item.ipAddress == this.ipAddress ||\r\n          (item.userId != null && item.userId == this.userId)\r\n        );\r\n      };\r\n    },\r\n    isleft() {\r\n      return function(item) {\r\n        return this.isSelf(item)\r\n          ? \"user-avatar right-avatar\"\r\n          : \"user-avatar left-avatar\";\r\n      };\r\n    },\r\n    isMyContent() {\r\n      return function(item) {\r\n        return this.isSelf(item) ? \"my-content\" : \"user-content\";\r\n      };\r\n    },\r\n    isMyMessage() {\r\n      return function(item) {\r\n        return this.isSelf(item) ? \"my-message\" : \"user-message\";\r\n      };\r\n    },\r\n    blogInfo() {\r\n      return this.$store.state.blogInfo;\r\n    },\r\n    nickname() {\r\n      return this.$store.state.nickname != null\r\n        ? this.$store.state.nickname\r\n        : this.ipAddress;\r\n    },\r\n    avatar() {\r\n      return this.$store.state.avatar != null\r\n        ? this.$store.state.avatar\r\n        : this.$store.state.blogInfo.websiteConfig.touristAvatar;\r\n    },\r\n    userId() {\r\n      return this.$store.state.userId;\r\n    },\r\n    isInput() {\r\n      return this.content.trim() != \"\"\r\n        ? \"iconfont iconzhifeiji submit-btn\"\r\n        : \"iconfont iconzhifeiji\";\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n@media (min-width: 760px) {\r\n  .chat-container {\r\n    position: fixed;\r\n    color: #4c4948 !important;\r\n    bottom: 104px;\r\n    right: 20px;\r\n    height: calc(85% - 64px - 20px);\r\n    max-height: 590px !important;\r\n    min-height: 250px !important;\r\n    width: 400px !important;\r\n    border-radius: 16px !important;\r\n  }\r\n  .close {\r\n    display: none;\r\n  }\r\n}\r\n@media (max-width: 760px) {\r\n  .chat-container {\r\n    position: fixed;\r\n    top: 0;\r\n    bottom: 0;\r\n    right: 0;\r\n    left: 0;\r\n  }\r\n  .close {\r\n    display: block;\r\n    margin-left: auto;\r\n  }\r\n}\r\n.chat-container {\r\n  box-shadow: 0 5px 40px rgba(0, 0, 0, 0.16) !important;\r\n  font-size: 14px;\r\n  background: #f4f6fb;\r\n  z-index: 1200;\r\n}\r\n.chat-btn {\r\n  background: #1f93ff;\r\n  border-radius: 100px !important;\r\n  position: fixed;\r\n  bottom: 15px;\r\n  right: 5px;\r\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.16) !important;\r\n  cursor: pointer;\r\n  height: 60px !important;\r\n  width: 60px !important;\r\n  z-index: 1000 !important;\r\n  user-select: none;\r\n}\r\n.header {\r\n  display: flex;\r\n  align-items: center;\r\n  padding: 20px 24px;\r\n  background: #ffffff;\r\n  border-radius: 1rem 1rem 0 0;\r\n  box-shadow: 0 10px 15px -16px rgba(50, 50, 93, 0.08),\r\n    0 4px 6px -8px rgba(50, 50, 93, 0.04);\r\n}\r\n.footer {\r\n  padding: 8px 16px;\r\n  position: absolute;\r\n  width: 100%;\r\n  bottom: 0;\r\n  background: #f7f7f7;\r\n  border-radius: 0 0 1rem 1rem;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n.footer textarea {\r\n  background: #fff;\r\n  padding-left: 10px;\r\n  padding-top: 8px;\r\n  width: 100%;\r\n  height: 32px;\r\n  outline: none;\r\n  resize: none;\r\n  overflow: hidden;\r\n  font-size: 13px;\r\n}\r\n.voice-btn {\r\n  font-size: 13px;\r\n  outline: none;\r\n  height: 32px;\r\n  width: 100%;\r\n  background: #fff;\r\n  border-radius: 2px;\r\n}\r\n.message {\r\n  position: absolute;\r\n  width: 100%;\r\n  padding: 20px 16px 0 16px;\r\n  top: 80px;\r\n  bottom: 50px;\r\n  overflow-y: auto;\r\n  overflow-x: hidden;\r\n}\r\n.text {\r\n  color: #999;\r\n  text-align: center;\r\n  font-size: 12px;\r\n  margin-bottom: 12px;\r\n}\r\n.user-message {\r\n  display: flex;\r\n  margin-bottom: 10px;\r\n}\r\n.my-message {\r\n  display: flex;\r\n  margin-bottom: 10px;\r\n  justify-content: flex-end;\r\n}\r\n.left-avatar {\r\n  margin-right: 10px;\r\n}\r\n.right-avatar {\r\n  order: 1;\r\n  margin-left: 10px;\r\n}\r\n.user-avatar {\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n}\r\n.nickname {\r\n  display: flex;\r\n  align-items: center;\r\n  font-size: 12px;\r\n  margin-top: 3px;\r\n  margin-bottom: 5px;\r\n}\r\n.user-content {\r\n  position: relative;\r\n  background-color: #fff;\r\n  padding: 10px;\r\n  border-radius: 5px 20px 20px 20px;\r\n  width: fit-content;\r\n  white-space: pre-line;\r\n  word-wrap: break-word;\r\n  word-break: break-all;\r\n}\r\n.my-content {\r\n  position: relative;\r\n  border-radius: 20px 5px 20px 20px;\r\n  padding: 12px;\r\n  background: #12b7f5;\r\n  color: #fff;\r\n  white-space: pre-line;\r\n  word-wrap: break-word;\r\n  word-break: break-all;\r\n}\r\n.submit-btn {\r\n  color: rgb(31, 147, 255);\r\n}\r\n.emoji {\r\n  cursor: pointer;\r\n  font-size: 1.3rem;\r\n  margin: 0 8px;\r\n}\r\n.emoji-box {\r\n  position: absolute;\r\n  box-shadow: 0 8px 16px rgba(50, 50, 93, 0.08), 0 4px 12px rgba(0, 0, 0, 0.07);\r\n  background: #fff;\r\n  border-radius: 8px;\r\n  right: 20px;\r\n  bottom: 52px;\r\n  height: 180px;\r\n  width: 300px;\r\n  overflow-y: auto;\r\n  padding: 6px 16px;\r\n}\r\n.emoji-border:before {\r\n  display: block;\r\n  height: 0;\r\n  width: 0;\r\n  content: \"\";\r\n  border-left: 14px solid transparent;\r\n  border-right: 14px solid transparent;\r\n  border-top: 12px solid #fff;\r\n  bottom: 40px;\r\n  position: absolute;\r\n  right: 43px;\r\n}\r\n.unread {\r\n  text-align: center;\r\n  border-radius: 50%;\r\n  font-size: 14px;\r\n  height: 20px;\r\n  width: 20px;\r\n  position: absolute;\r\n  background: #f24f2d;\r\n  color: #fff;\r\n}\r\n.back-menu {\r\n  font-size: 13px;\r\n  border-radius: 2px;\r\n  position: absolute;\r\n  background: rgba(255, 255, 255, 0.9);\r\n  color: #000;\r\n  width: 80px;\r\n  height: 35px;\r\n  text-align: center;\r\n  line-height: 35px;\r\n  display: none;\r\n}\r\n.voice {\r\n  position: fixed;\r\n  z-index: 1500;\r\n  bottom: 52px;\r\n  left: 0;\r\n  right: 0;\r\n  top: 80px;\r\n  background: rgba(0, 0, 0, 0.8);\r\n}\r\n.close-voice {\r\n  position: absolute;\r\n  bottom: 60px;\r\n  left: 30px;\r\n  display: inline-block;\r\n  height: 50px;\r\n  width: 50px;\r\n  line-height: 50px;\r\n  border-radius: 50%;\r\n  text-align: center;\r\n  background: #fff;\r\n}\r\n</style>\r\n"]}]}